{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///D:/ubatech/lib/firebase.ts"],"sourcesContent":["import { initializeApp, getApps, getApp } from \"firebase/app\"\nimport { getFirestore } from \"firebase/firestore\"\nimport type { FirebaseApp } from \"firebase/app\"\nimport type { Firestore } from \"firebase/firestore\"\n\nconst firebaseConfig = {\n  apiKey: \"AIzaSyB6Yczsu4sF8cjD4H1Jz2KU4TO9f0biCoQ\",\n  authDomain: \"ubatech-a8650.firebaseapp.com\",\n  projectId: \"ubatech-a8650\",\n  storageBucket: \"ubatech-a8650.firebasestorage.app\",\n  messagingSenderId: \"609393850830\",\n  appId: \"1:609393850830:web:567d90bdc33dd65fe2d39f\",\n  measurementId: \"G-G2DW96480G\",\n}\n\nlet app: FirebaseApp = (getApps().length === 0 ? initializeApp(firebaseConfig) : getApp())\nlet db: Firestore | null = null\n\ntry {\n  if (getApps().length === 0) {\n    app = initializeApp(firebaseConfig)\n  } else {\n    app = getApp()\n  }\n\n  const initFirestore = () => {\n    try {\n      db = getFirestore(app)\n      console.log(\"[v0] Firestore initialized successfully\")\n      return db\n    } catch (error) {\n      console.warn(\"[v0] Firestore not ready yet, will retry on access\")\n      return null\n    }\n  }\n\n  db = initFirestore()\n} catch (error) {\n  console.error(\"[v0] Firebase initialization error:\", error)\n}\n\nexport const getDb = () => {\n  if (!db) {\n    try {\n      db = getFirestore(getApp())\n    } catch (error) {\n      console.error(\"[v0] Failed to get Firestore instance:\", error)\n      throw new Error(\"Firestore is not available. Please ensure Firestore Database is created in Firebase Console.\")\n    }\n  }\n  return db\n}\n\nexport { app }\nexport default db\n"],"names":[],"mappings":";;;;;;;;AAAA;AAAA;AACA;AAAA;;;AAIA,MAAM,iBAAiB;IACrB,QAAQ;IACR,YAAY;IACZ,WAAW;IACX,eAAe;IACf,mBAAmB;IACnB,OAAO;IACP,eAAe;AACjB;AAEA,IAAI,MAAoB,IAAA,iLAAO,IAAG,MAAM,KAAK,IAAI,IAAA,uLAAa,EAAC,kBAAkB,IAAA,gLAAM;AACvF,IAAI,KAAuB;AAE3B,IAAI;IACF,IAAI,IAAA,iLAAO,IAAG,MAAM,KAAK,GAAG;QAC1B,MAAM,IAAA,uLAAa,EAAC;IACtB,OAAO;QACL,MAAM,IAAA,gLAAM;IACd;IAEA,MAAM,gBAAgB;QACpB,IAAI;YACF,KAAK,IAAA,mLAAY,EAAC;YAClB,QAAQ,GAAG,CAAC;YACZ,OAAO;QACT,EAAE,OAAO,OAAO;YACd,QAAQ,IAAI,CAAC;YACb,OAAO;QACT;IACF;IAEA,KAAK;AACP,EAAE,OAAO,OAAO;IACd,QAAQ,KAAK,CAAC,uCAAuC;AACvD;AAEO,MAAM,QAAQ;IACnB,IAAI,CAAC,IAAI;QACP,IAAI;YACF,KAAK,IAAA,mLAAY,EAAC,IAAA,gLAAM;QAC1B,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,0CAA0C;YACxD,MAAM,IAAI,MAAM;QAClB;IACF;IACA,OAAO;AACT;;uCAGe","debugId":null}},
    {"offset": {"line": 198, "column": 0}, "map": {"version":3,"sources":["file:///D:/ubatech/app/api/admin/analytics/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\r\nimport { getDb } from \"@/lib/firebase\"\r\nimport { collection, getDocs, query, where } from \"firebase/firestore\"\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const db = getDb()\r\n\r\n    // Obtener todos los productos\r\n    const productsSnapshot = await getDocs(collection(db, \"products\"))\r\n    const products = productsSnapshot.docs.map((doc) => ({\r\n      id: doc.id,\r\n      ...doc.data(),\r\n    }))\r\n\r\n    // Obtener todas las categorías\r\n    const categoriesSnapshot = await getDocs(collection(db, \"categories\"))\r\n    const categories = categoriesSnapshot.docs.map((doc) => ({\r\n      id: doc.id,\r\n      ...doc.data(),\r\n    }))\r\n\r\n    // Obtener todas las órdenes (si existen)\r\n    let orders: any[] = []\r\n    try {\r\n      const ordersSnapshot = await getDocs(collection(db, \"orders\"))\r\n      orders = ordersSnapshot.docs.map((doc) => ({\r\n        id: doc.id,\r\n        ...doc.data(),\r\n      }))\r\n    } catch (error) {\r\n      console.log(\"[Analytics] No orders collection found, skipping orders data\")\r\n    }\r\n\r\n    // Obtener usuarios (si existen)\r\n    let users: any[] = []\r\n    try {\r\n      const usersSnapshot = await getDocs(collection(db, \"users\"))\r\n      users = usersSnapshot.docs.map((doc) => ({\r\n        id: doc.id,\r\n        ...doc.data(),\r\n      }))\r\n    } catch (error) {\r\n      console.log(\"[Analytics] No users collection found, skipping users data\")\r\n    }\r\n\r\n    // Calcular estadísticas\r\n    const totalProducts = products.length\r\n    const totalOrders = orders.length\r\n    const totalUsers = users.length\r\n    \r\n    // Calcular ventas totales\r\n    const totalSales = orders.reduce((sum: number, order: any) => {\r\n      return sum + (order.total || 0)\r\n    }, 0)\r\n\r\n    // Generar datos de ventas mensuales (últimos 6 meses)\r\n    const monthlySales = generateMonthlySalesData(orders)\r\n\r\n    // Top 5 productos más vendidos\r\n    const topProducts = getTopProducts(orders, products)\r\n\r\n    // Estado de pedidos\r\n    const ordersByStatus = getOrdersByStatus(orders)\r\n\r\n    return NextResponse.json({\r\n      totalSales: totalSales,\r\n      totalOrders: totalOrders,\r\n      totalUsers: totalUsers,\r\n      totalProducts: totalProducts,\r\n      monthlySales: monthlySales,\r\n      topProducts: topProducts,\r\n      ordersByStatus: ordersByStatus,\r\n    })\r\n  } catch (error) {\r\n    console.error(\"[Analytics API] Error:\", error)\r\n    return NextResponse.json(\r\n      {\r\n        error: \"Error al obtener estadísticas\",\r\n        totalSales: 0,\r\n        totalOrders: 0,\r\n        totalUsers: 0,\r\n        totalProducts: 0,\r\n        monthlySales: [],\r\n        topProducts: [],\r\n        ordersByStatus: [],\r\n      },\r\n      { status: 200 }\r\n    )\r\n  }\r\n}\r\n\r\nfunction generateMonthlySalesData(orders: any[]) {\r\n  const months = [\"Ene\", \"Feb\", \"Mar\", \"Abr\", \"May\", \"Jun\"]\r\n  const monthlySalesMap = new Map<string, { sales: number; orders: number }>()\r\n\r\n  // Inicializar últimos 6 meses\r\n  const now = new Date()\r\n  for (let i = 5; i >= 0; i--) {\r\n    const date = new Date(now.getFullYear(), now.getMonth() - i, 1)\r\n    const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, \"0\")}`\r\n    monthlySalesMap.set(monthKey, { sales: 0, orders: 0 })\r\n  }\r\n\r\n  // Agregar datos de órdenes\r\n  orders.forEach((order: any) => {\r\n    const orderDate = order.createdAt\r\n      ? new Date(order.createdAt.seconds ? order.createdAt.seconds * 1000 : order.createdAt)\r\n      : new Date()\r\n    const monthKey = `${orderDate.getFullYear()}-${String(orderDate.getMonth() + 1).padStart(2, \"0\")}`\r\n\r\n    if (monthlySalesMap.has(monthKey)) {\r\n      const current = monthlySalesMap.get(monthKey)!\r\n      current.sales += order.total || 0\r\n      current.orders += 1\r\n    }\r\n  })\r\n\r\n  // Convertir a array con formato para gráfico\r\n  return months.map((month, index) => {\r\n    const now = new Date()\r\n    const date = new Date(now.getFullYear(), now.getMonth() - (5 - index), 1)\r\n    const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, \"0\")}`\r\n    const data = monthlySalesMap.get(monthKey) || { sales: 0, orders: 0 }\r\n\r\n    return {\r\n      month: month,\r\n      sales: data.sales,\r\n      orders: data.orders,\r\n    }\r\n  })\r\n}\r\n\r\nfunction getTopProducts(orders: any[], products: any[]) {\r\n  const productSalesMap = new Map<string, number>()\r\n\r\n  orders.forEach((order: any) => {\r\n    const items = order.items || []\r\n    items.forEach((item: any) => {\r\n      const currentSales = productSalesMap.get(item.name) || 0\r\n      productSalesMap.set(item.name, currentSales + (item.quantity || 1))\r\n    })\r\n  })\r\n\r\n  // Convertir a array y ordenar\r\n  const topProductsArray = Array.from(productSalesMap.entries())\r\n    .map(([name, sales]) => ({ name, sales }))\r\n    .sort((a, b) => b.sales - a.sales)\r\n    .slice(0, 5)\r\n\r\n  // Si no hay órdenes, mostrar productos del catálogo\r\n  if (topProductsArray.length === 0) {\r\n    return products.slice(0, 5).map((p: any) => ({\r\n      name: p.name || \"Producto sin nombre\",\r\n      sales: 0,\r\n    }))\r\n  }\r\n\r\n  return topProductsArray\r\n}\r\n\r\nfunction getOrdersByStatus(orders: any[]) {\r\n  const statusMap = new Map<string, number>()\r\n\r\n  // Status por defecto\r\n  const defaultStatuses = [\"Pendiente\", \"Procesando\", \"Enviado\", \"Entregado\", \"Cancelado\"]\r\n  defaultStatuses.forEach((status) => {\r\n    statusMap.set(status, 0)\r\n  })\r\n\r\n  // Contar órdenes por estado\r\n  orders.forEach((order: any) => {\r\n    const status = order.status || \"Pendiente\"\r\n    statusMap.set(status, (statusMap.get(status) || 0) + 1)\r\n  })\r\n\r\n  // Convertir a array\r\n  return Array.from(statusMap.entries())\r\n    .map(([status, count]) => ({ status, count }))\r\n    .filter((item) => item.count > 0)\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}