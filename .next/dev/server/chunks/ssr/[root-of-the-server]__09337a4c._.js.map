{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 232, "column": 0}, "map": {"version":3,"sources":["file:///D:/ubatech/lib/firebase.ts"],"sourcesContent":["import { initializeApp, getApps, getApp } from \"firebase/app\"\nimport { getFirestore } from \"firebase/firestore\"\nimport type { FirebaseApp } from \"firebase/app\"\nimport type { Firestore } from \"firebase/firestore\"\n\nconst firebaseConfig = {\n  apiKey: \"AIzaSyB6Yczsu4sF8cjD4H1Jz2KU4TO9f0biCoQ\",\n  authDomain: \"ubatech-a8650.firebaseapp.com\",\n  projectId: \"ubatech-a8650\",\n  storageBucket: \"ubatech-a8650.firebasestorage.app\",\n  messagingSenderId: \"609393850830\",\n  appId: \"1:609393850830:web:567d90bdc33dd65fe2d39f\",\n  measurementId: \"G-G2DW96480G\",\n}\n\nlet app: FirebaseApp = (getApps().length === 0 ? initializeApp(firebaseConfig) : getApp())\nlet db: Firestore | null = null\n\ntry {\n  if (getApps().length === 0) {\n    app = initializeApp(firebaseConfig)\n  } else {\n    app = getApp()\n  }\n\n  const initFirestore = () => {\n    try {\n      db = getFirestore(app)\n      console.log(\"[v0] Firestore initialized successfully\")\n      return db\n    } catch (error) {\n      console.warn(\"[v0] Firestore not ready yet, will retry on access\")\n      return null\n    }\n  }\n\n  db = initFirestore()\n} catch (error) {\n  console.error(\"[v0] Firebase initialization error:\", error)\n}\n\nexport const getDb = () => {\n  if (!db) {\n    try {\n      db = getFirestore(getApp())\n    } catch (error) {\n      console.error(\"[v0] Failed to get Firestore instance:\", error)\n      throw new Error(\"Firestore is not available. Please ensure Firestore Database is created in Firebase Console.\")\n    }\n  }\n  return db\n}\n\nexport { app }\nexport default db\n"],"names":[],"mappings":";;;;;;;;AAAA;AAAA;AACA;AAAA;;;AAIA,MAAM,iBAAiB;IACrB,QAAQ;IACR,YAAY;IACZ,WAAW;IACX,eAAe;IACf,mBAAmB;IACnB,OAAO;IACP,eAAe;AACjB;AAEA,IAAI,MAAoB,IAAA,+KAAO,IAAG,MAAM,KAAK,IAAI,IAAA,qLAAa,EAAC,kBAAkB,IAAA,8KAAM;AACvF,IAAI,KAAuB;AAE3B,IAAI;IACF,IAAI,IAAA,+KAAO,IAAG,MAAM,KAAK,GAAG;QAC1B,MAAM,IAAA,qLAAa,EAAC;IACtB,OAAO;QACL,MAAM,IAAA,8KAAM;IACd;IAEA,MAAM,gBAAgB;QACpB,IAAI;YACF,KAAK,IAAA,iLAAY,EAAC;YAClB,QAAQ,GAAG,CAAC;YACZ,OAAO;QACT,EAAE,OAAO,OAAO;YACd,QAAQ,IAAI,CAAC;YACb,OAAO;QACT;IACF;IAEA,KAAK;AACP,EAAE,OAAO,OAAO;IACd,QAAQ,KAAK,CAAC,uCAAuC;AACvD;AAEO,MAAM,QAAQ;IACnB,IAAI,CAAC,IAAI;QACP,IAAI;YACF,KAAK,IAAA,iLAAY,EAAC,IAAA,8KAAM;QAC1B,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,0CAA0C;YACxD,MAAM,IAAI,MAAM;QAClB;IACF;IACA,OAAO;AACT;;uCAGe","debugId":null}},
    {"offset": {"line": 294, "column": 0}, "map": {"version":3,"sources":["file:///D:/ubatech/app/admin/login/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport type React from \"react\"\r\n\r\nimport { useState } from \"react\"\r\nimport { useRouter } from \"next/navigation\"\r\nimport { getAuth, signInWithEmailAndPassword } from \"firebase/auth\"\r\nimport { app, getDb } from \"@/lib/firebase\"\r\nimport { doc, getDoc } from \"firebase/firestore\"\r\nimport Image from \"next/image\"\r\n\r\nexport default function AdminLoginPage() {\r\n  const [email, setEmail] = useState(\"\")\r\n  const [password, setPassword] = useState(\"\")\r\n  const [error, setError] = useState(\"\")\r\n  const [loading, setLoading] = useState(false)\r\n  // Registro deshabilitado, solo login\r\n  const router = useRouter()\r\n\r\n  async function handleSubmit(e: React.FormEvent) {\r\n    e.preventDefault()\r\n    setError(\"\")\r\n    setLoading(true)\r\n\r\n    if (!email || !password) {\r\n      setError(\"Por favor completa email y contraseña\")\r\n      setLoading(false)\r\n      return\r\n    }\r\n\r\n    const auth = getAuth(app)\r\n    try {\r\n      // Solo login de admin\r\n      const userCredential = await signInWithEmailAndPassword(auth, email, password)\r\n      \r\n      // Validar que el usuario exista en Firestore como administrador\r\n      // Esperar un momento para permitir sincronización de datos\r\n      await new Promise(resolve => setTimeout(resolve, 500))\r\n      \r\n      try {\r\n        const db = getDb()\r\n        const userDoc = await getDoc(doc(db, \"adminUsers\", userCredential.user.uid))\r\n        \r\n        if (!userDoc.exists()) {\r\n          // Usuario no existe en adminUsers después de esperar\r\n          // Reintentar una vez más antes de hacer logout\r\n          await new Promise(resolve => setTimeout(resolve, 500))\r\n          const retryDoc = await getDoc(doc(db, \"adminUsers\", userCredential.user.uid))\r\n          \r\n          if (!retryDoc.exists()) {\r\n            // Realmente no existe, eliminar de Firebase Auth\r\n            await userCredential.user.delete()\r\n            setError(\"Usuario no encontrado en la base de datos de administradores\")\r\n            setEmail(\"\")\r\n            setPassword(\"\")\r\n            setLoading(false)\r\n            return\r\n          }\r\n          \r\n          // Ahora existe, obtener rol\r\n          const userData = retryDoc.data()\r\n          const role = userData.role\r\n          \r\n          if (typeof window !== \"undefined\") {\r\n            localStorage.setItem(\"adminRole\", role)\r\n          }\r\n          \r\n          router.push(\"/admin/dashboard\")\r\n        } else {\r\n          // Usuario existe, obtener rol\r\n          const userData = userDoc.data()\r\n          const role = userData.role\r\n          \r\n          if (typeof window !== \"undefined\") {\r\n            localStorage.setItem(\"adminRole\", role)\r\n          }\r\n          \r\n          router.push(\"/admin/dashboard\")\r\n        }\r\n      } catch (err) {\r\n        console.error(\"Error fetching user role:\", err)\r\n        setError(\"Error al validar usuario en la base de datos\")\r\n        setEmail(\"\")\r\n        setPassword(\"\")\r\n        setLoading(false)\r\n      }\r\n    } catch (error: any) {\r\n      setError(\"Email o contraseña incorrectos\")\r\n      setEmail(\"\")\r\n      setPassword(\"\")\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div\r\n      className=\"min-h-screen flex items-center justify-center p-4\"\r\n      style={{ backgroundColor: \"var(--neutral-light)\" }}\r\n    >\r\n      <div className=\"w-full max-w-md\">\r\n        <div className=\"bg-white rounded-lg shadow-lg p-8\">\r\n          <div className=\"flex justify-center mb-8\">\r\n            <div className=\"w-32 h-32 relative\">\r\n              <Image src=\"/logo-ubatech.png\" alt=\"Ubatech+Pro\" fill className=\"object-contain\" />\r\n            </div>\r\n          </div>\r\n\r\n          <h1 className=\"text-2xl font-bold text-center mb-2\" style={{ color: \"var(--primary-dark)\" }}>\r\n            Panel Administrativo\r\n          </h1>\r\n          <p className=\"text-center text-gray-600 mb-8\">Ubatech+Pro - Confianza & Seguridad</p>\r\n\r\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium mb-2 text-black\" style={{ color: \"var(--primary-dark)\" }}>\r\n                Email\r\n              </label>\r\n              <input\r\n                type=\"email\"\r\n                value={email}\r\n                onChange={(e) => setEmail(e.target.value)}\r\n                placeholder=\"admin@ubatech.com\"\r\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-0 text-black bg-white\"\r\n                style={{ \"--tw-ring-color\": \"var(--accent-turquoise)\" } as React.CSSProperties}\r\n                disabled={loading}\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-medium mb-2 text-black\" style={{ color: \"var(--primary-dark)\" }}>\r\n                Contraseña\r\n              </label>\r\n              <input\r\n                type=\"password\"\r\n                value={password}\r\n                onChange={(e) => setPassword(e.target.value)}\r\n                placeholder=\"Ingresa tu contraseña\"\r\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-0 text-black bg-white\"\r\n                style={{ \"--tw-ring-color\": \"var(--accent-turquoise)\" } as React.CSSProperties}\r\n                disabled={loading}\r\n              />\r\n            </div>\r\n\r\n            {error && <div className=\"bg-red-100 text-red-700 p-3 rounded-lg text-sm\">{error}</div>}\r\n\r\n            <button\r\n              type=\"submit\"\r\n              disabled={loading}\r\n              className=\"w-full py-2 px-4 text-white rounded-lg font-medium transition-all hover:opacity-90 disabled:opacity-50\"\r\n              style={{ backgroundColor: \"var(--primary-dark)\" }}\r\n            >\r\n              {loading ? \"Verificando...\" : \"Acceder\"}\r\n            </button>\r\n          </form>\r\n\r\n\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}